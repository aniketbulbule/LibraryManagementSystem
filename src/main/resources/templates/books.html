<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="layout :: content">
<body>
  <h2>Books</h2>
  <form method="get" th:action="@{/books}">
    <input type="text" name="q" placeholder="Search title">
    <button type="submit">Search</button>
  </form>
  <p th:if="${error}" th:text="${error}"></p>

  <table>
    <tr><th>Image</th><th>Title</th><th>Author</th><th>Avail</th><th>Actions</th></tr>
    <tr th:each="b : ${books}">
      <td>
        <img th:if="${b.imagePath}" th:src="${b.imagePath}" alt="cover" style="height:60px;">
      </td>
      <td th:text="${b.title}"></td>
      <td th:text="${b.author}"></td>
      <td th:text="${b.availableCopies}"></td>
      <td>
        <form th:action="@{'/user/borrow/' + ${b.id}}" method="post" sec:authorize="isAuthenticated()">
          <button type="submit" th:disabled="${b.availableCopies == 0}">Borrow</button>
        </form>
        <form th:action="@{'/user/reserve/' + ${b.id}}" method="post" sec:authorize="isAuthenticated()">
          <button type="submit" th:disabled="${b.availableCopies > 0}">Reserve</button>
        </form>
      </td>
    </tr>
  </table>
</body>
</html>
